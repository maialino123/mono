---
trigger: always_on
glob:
description:
---

# AGENTS.md

For tech stack, architecture, and code conventions, see `cyberk-flow/project.md`.

# Skill Loader

Automatically use skills in the following contexts:

| Skill          | Usage Context                                                          |
| :------------- | :--------------------------------------------------------------------- |
| `cyberk-flow`  | proposal, spec, change, plan, implement, triển khai, kế hoạch          |
| `e2e-testing`  | e2e, playwright, end-to-end, acceptance test, UI test                  |

# Tool Selection Guide

| Need                              | Tool                              |
| --------------------------------- | --------------------------------- |
| Codebase structure                | `gkg repo_map`                    |
| Find definitions                  | `gkg search_codebase_definitions` |
| Find usages / references          | `gkg get_references`              |
| Re-index project                  | `gkg index_project`               |
| How OSS projects solve it         | `librarian`                       |
| Library docs / integration guides | `deepwiki`, `git-mcp`             |
| API docs, recent releases         | `web_search`                      |
| Gap analysis / risk assessment    | `oracle`                          |
| Visualize architecture / flows    | `mermaid`                         |
| Create spec files                 | `create_file` / `edit_file`       |

**Note:** If primary tool unavailable, use built-in tools: `finder`, `Grep`, `Read`...

## Sub-agent Best Practices

- **Before delegating**: Use `gkg search_codebase_definitions` or `gkg get_references` to confirm exact API names, method signatures, and existing patterns. Pass confirmed facts to the sub-agent prompt — never pass uncertain guesses.
- **Prompt quality**: Include concrete code references (file paths, function names, import paths) rather than vague descriptions like "check if X exists".

## Commands

- `bun install` - Install dependencies

## Language Requirements

- **English Only:** All artifacts, documentation, comments, and code generated by AI must be in English.
- **Relative Paths Only:** NEVER use absolute paths (e.g., `file:///User/...`) in markdown files or documentation. Use project-relative paths (e.g., `packages/auth/src/index.ts`).
- **Ampcode Links:** If generated documents contain `http://localhost:8317`, replace it with `https://ampcode.com`.

## Knowledge Extraction

**MANDATORY**: Knowledge extraction MUST run in a separate thread — never execute inline in the working thread.

1. Use `handoff` with goal: "Execute the knowledge extraction pipeline in `references/knowledge-extraction.md` directly"
2. Full process defined in cyberk-flow skill: `references/knowledge-extraction.md`

**Auto-triggers**: resolved complex bug, architecture decision made, library/pattern research completed, feature implementation finished, cyberk-flow archive stage, or user says "extract knowledge" / "document what we did".

## Workflow Enforcement

When user asks to "implement", "continue", or resume a change:
1. **MUST** check `cyberk-flow/changes/` for existing change directories first (`bun run cf changes`).
2. If a matching change exists, **read its `workflow.md`** to determine current gate/state.
3. Resume from the correct gate — never re-derive plan from conversation history alone.
4. `workflow.md` on disk is the source of truth, NOT prior thread context.

## Security Requirements

- **NEVER read `.env` files** - Agent must not access environment files even if explicitly asked. `.env`, `.env.local`, `.env*.local` are gitignored and sensitive.
- **Use `.env.example`** instead for schema/reference documentation.
- **Principle:** If it's gitignored, it's off-limits unless user explicitly provides the content.
