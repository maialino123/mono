# Discovery: Google Login Integration

## 1. Feature Summary

Integrate Google OAuth login into the existing authentication system (better-auth). This involves updating the backend configuration, environment variables, and frontend UI to support "Sign in with Google".

## 2. Architecture Snapshot

### Relevant Packages

| Package | Purpose | Key Files |
| :--- | :--- | :--- |
| `packages/auth` | Auth configuration | `src/index.ts` |
| `packages/env` | Environment variables | `src/server.ts` |
| `apps/web` | Frontend application | `src/components/sign-in-form.tsx`, `src/components/sign-up-form.tsx` |
| `packages/db` | Database schema | `src/schema/auth.ts` |

### Entry Points

-   **API**: `better-auth` endpoints (handled automatically by the library).
-   **UI**: `SignInForm` and `SignUpForm` components in `apps/web`.

## 3. Existing Patterns

### Authentication

-   Currently uses `emailAndPassword` provider.
-   `better-auth` is configured in `packages/auth/src/index.ts`.
-   Frontend uses `authClient` from `@/lib/auth-client`.

### Environment Variables

-   Managed by `@cyberk-flow/env` using `@t3-oss/env-core`.
-   Server-side variables defined in `packages/env/src/server.ts`.

## 4. Technical Constraints

-   **Native App**: Explicitly excluded from this scope.
-   **Database**: Schema already has `account` table which supports OAuth providers, so no schema changes should be needed (need to verify).
-   **Documentation**: Must include a guide on creating Google Access Keys.

## 5. External References

-   [Better Auth Social Plugins](https://www.better-auth.com/docs/concepts/social-sign-in)
-   [Google Cloud Console](https://console.cloud.google.com/)

## 6. Gap Analysis (Synthesized)

| Component | Have | Need | Gap Size |
| :--- | :--- | :--- | :--- |
| **Auth Config** | Email/Password enabled | Google provider enabled | Small |
| **Env Vars** | `BETTER_AUTH_SECRET`, etc. | `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET` | Small |
| **UI** | Email/Password forms | "Sign in with Google" button | Small |
| **Docs** | N/A | Guide for Google Keys | Small |

## 7. Open Questions

-   [ ] Does the existing `account` table schema fully support `better-auth`'s Google provider requirements without modification? (Likely yes, as it's generated by better-auth CLI/helpers usually, but worth a quick check if possible or just assume standard better-auth schema).

## 8. Plan

1.  **Docs**: Create `docs/google-auth-setup.md`.
2.  **Env**: Add `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET` to `packages/env/src/server.ts`.
3.  **Auth Config**: Enable `socialProviders: { google: ... }` in `packages/auth/src/index.ts`.
4.  **UI**: Add Google login button to `SignInForm` and `SignUpForm` in `apps/web`.
